<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>üñºÔ∏è Image Display Test</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Courier New', monospace; 
            background: #0a0a0a; 
            color: #00ff00;
            padding: 20px;
        }
        h1 { 
            text-align: center;
            font-size: 2em;
            margin-bottom: 30px;
            text-shadow: 0 0 10px #00ff00;
        }
        .section { 
            background: #1a1a1a; 
            border: 2px solid #00ff00;
            border-radius: 8px; 
            padding: 20px;
            margin-bottom: 20px;
        }
        .image-test {
            display: grid;
            gap: 20px;
            margin-top: 20px;
        }
        .image-item {
            background: #000;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #333;
        }
        .image-item img {
            max-width: 300px;
            max-height: 200px;
            border: 2px solid #00ff00;
            display: block;
            margin-top: 10px;
        }
        .image-item .error {
            color: #ff0000;
            margin-top: 10px;
        }
        button {
            background: #00ff00;
            color: #0a0a0a;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
        }
        button:hover { background: #00cc00; }
        pre {
            background: #000;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
        .success { color: #00ff00; }
        .error { color: #ff0000; }
    </style>
</head>
<body>
    <h1>üñºÔ∏è IMAGE DISPLAY TEST</h1>
    
    <div class="section">
        <h2>Control Panel</h2>
        <button onclick="testImages()">üîç Test All Images</button>
        <button onclick="checkUploadsFolder()">üìÅ Check Uploads Folder</button>
        <button onclick="clearResults()">üóëÔ∏è Clear</button>
    </div>

    <div id="results"></div>

    <script>
        const API_BASE = 'http://localhost:8080/server/api/admin';
        
        function log(title, content, type = 'info') {
            const div = document.createElement('div');
            div.className = 'section';
            div.innerHTML = `
                <h2>${title}</h2>
                <div class="${type}">${
                    typeof content === 'object' 
                        ? '<pre>' + JSON.stringify(content, null, 2) + '</pre>'
                        : content
                }</div>
            `;
            document.getElementById('results').insertBefore(div, document.getElementById('results').firstChild);
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
        
        async function testImages() {
            clearResults();
            
            try {
                // Fetch packages
                const res = await fetch(`${API_BASE}/packages.php`, {
                    credentials: 'include'
                });
                
                const data = await res.json();
                const packages = data.data || data;
                
                log('üì¶ Fetched Packages', {
                    total: packages.length,
                    packages: packages.map(p => ({
                        id: p.id,
                        title: p.title_en,
                        image: p.image
                    }))
                }, 'success');
                
                // Test each image
                const imageTests = document.createElement('div');
                imageTests.className = 'section';
                imageTests.innerHTML = '<h2>üñºÔ∏è Image Display Tests</h2><div class="image-test"></div>';
                document.getElementById('results').insertBefore(imageTests, document.getElementById('results').firstChild);
                
                const testContainer = imageTests.querySelector('.image-test');
                
                for (const pkg of packages) {
                    if (!pkg.image) continue;
                    
                    const item = document.createElement('div');
                    item.className = 'image-item';
                    item.innerHTML = `
                        <strong>${pkg.title_en}</strong>
                        <div>Image path: <code>${pkg.image}</code></div>
                        <img src="${pkg.image}" 
                             onload="this.nextElementSibling.innerHTML='‚úÖ Loaded successfully'"
                             onerror="this.nextElementSibling.innerHTML='‚ùå Failed to load<br>URL: ${pkg.image}'">
                        <div class="status">‚è≥ Loading...</div>
                    `;
                    testContainer.appendChild(item);
                    
                    // Test if URL is accessible
                    try {
                        const imgRes = await fetch(pkg.image, { method: 'HEAD' });
                        console.log(`${pkg.title_en}: ${imgRes.status} - ${pkg.image}`);
                    } catch (e) {
                        console.error(`${pkg.title_en}: Failed - ${pkg.image}`, e);
                    }
                }
                
            } catch (error) {
                log('‚ùå Test Failed', error.message, 'error');
            }
        }
        
        async function checkUploadsFolder() {
            // This would need a PHP endpoint to list files
            log('‚ÑπÔ∏è Manual Check Required', `
                <p>Please manually check:</p>
                <ol>
                    <li>Go to: <code>D:\\xampp\\htdocs\\server\\uploads\\</code></li>
                    <li>Check if your uploaded images are there</li>
                    <li>Copy one filename and test this URL format:</li>
                </ol>
                <code>http://localhost:8080/server/uploads/YOUR_FILENAME.png</code>
                <p style="margin-top: 10px;">Try pasting this in your browser to see if the image loads directly.</p>
            `, 'info');
        }
        
        // Auto-run on load
        setTimeout(testImages, 1000);
    </script>
</body>
</html>